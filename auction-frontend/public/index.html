<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VietDauGia - Trang ch·ªß</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f7f7f7; }
    .category-list { background: white; border-radius: 6px; padding: 10px; }
    .product-card { background: white; border-radius: 8px; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: 0.2s ease; }
    .product-card:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .product-img { height: 180px; object-fit: cover; border-radius: 5px; }
    .category-item.active { background-color: #0d6efd; color: white; }
  </style>
</head>
<body class="container py-4">
  <!-- Navbar ƒëi·ªÅu h∆∞·ªõng -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">üè† VietDauGia</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="/login.html">ƒêƒÉng nh·∫≠p</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/register.html">ƒêƒÉng k√Ω</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/dashboard.html">Dashboard</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="row">
    <!-- DANH M·ª§C -->
    <div class="col-md-3">
      <div class="category-list">
        <h5>Danh m·ª•c</h5>
        <ul class="list-group list-group-flush" id="categoryList">
          <li class="list-group-item category-item active" data-category="">T·∫•t c·∫£</li>
          <li class="list-group-item category-item" data-category="ƒê·ªì ƒëi·ªán t·ª≠, AV & M√°y ·∫£nh">ƒê·ªì ƒëi·ªán t·ª≠, AV & M√°y ·∫£nh</li>
          <li class="list-group-item category-item" data-category="ƒê·ªìng h·ªì & Ph·ª• ki·ªán">ƒê·ªìng h·ªì & Ph·ª• ki·ªán</li>
          <li class="list-group-item category-item" data-category="ƒêi·ªán t·ª≠ vƒÉn ph√≤ng">ƒêi·ªán t·ª≠ vƒÉn ph√≤ng</li>
          <li class="list-group-item category-item" data-category="Th·ªùi trang - Ph·ª• ki·ªán">Th·ªùi trang - Ph·ª• ki·ªán</li>
          <li class="list-group-item category-item" data-category="√Çm nh·∫°c">√Çm nh·∫°c</li>
          <li class="list-group-item category-item" data-category="ƒê·ªì ch∆°i & Tr√≤ ch∆°i">ƒê·ªì ch∆°i & Tr√≤ ch∆°i</li>
          <li class="list-group-item category-item" data-category="S∆∞u t·∫ßm ƒë·ªì c·ªï">S∆∞u t·∫ßm ƒë·ªì c·ªï</li>
        </ul>
      </div>
    </div>

    <!-- DANH S√ÅCH S·∫¢N PH·∫®M -->
    <div class="col-md-9">
      <h5 class="mb-3">S·∫£n ph·∫©m ƒë·∫•u gi√°</h5>
      <div class="row" id="productList"></div>
    </div>
  </div>

  <script>
    const productListEl = document.getElementById("productList");
    const categoryItems = document.querySelectorAll(".category-item");

    function updateCountdown(el, endTime) {
      const end = new Date(endTime);
      function update() {
        const now = new Date();
        const diff = end - now;
        if (diff <= 0) {
          el.innerText = "ƒê√£ k·∫øt th√∫c";
          el.classList.replace("bg-dark", "bg-danger");
          return;
        }
        const h = Math.floor(diff / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        const s = Math.floor((diff % 60000) / 1000);
        el.innerText = `${h}h ${m}m ${s}s`;
      }
      update();
      setInterval(update, 1000);
    }

    async function loadProducts(category = "") {
      productListEl.innerHTML = "üîÑ ƒêang t·∫£i...";
      let url = "https://vietdaugia-api.onrender.com/products";
      if (category) url += `?category=${encodeURIComponent(category)}`;
      
      const res = await fetch(url);
      const products = await res.json();

      if (!products.length) {
        productListEl.innerHTML = `<div class="alert alert-warning">Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o trong m·ª•c n√†y.</div>`;
        return;
      }

      const html = products.map((p, i) => `
        <div class="col-md-4 mb-4">
          <div class="card">
            <img src="${p.image || 'https://via.placeholder.com/400x200?text=No+Image'}" class="card-img-top product-img" />
            <div class="card-body">
              <h5 class="card-title">${p.name}</h5>
              <p class="card-text">
                Gi√° hi·ªán t·∫°i: <strong>${p.currentPrice.toLocaleString()}ƒë</strong><br/>
                ‚è≥ C√≤n l·∫°i: <span class="badge bg-dark" id="countdown-${i}">...</span>
              </p>
              <a href="/product.html?id=${p._id}" class="btn btn-primary btn-sm">Xem chi ti·∫øt</a>
            </div>
          </div>
        </div>
      `).join("");

      productListEl.innerHTML = html;

      // C·∫≠p nh·∫≠t th·ªùi gian c√≤n l·∫°i cho t·ª´ng s·∫£n ph·∫©m
      products.forEach((p, i) => {
        const countdownEl = document.getElementById(`countdown-${i}`);
        updateCountdown(countdownEl, p.endTime);
      });
    }

    // X·ª≠ l√Ω click danh m·ª•c
    categoryItems.forEach(el => {
      el.addEventListener("click", () => {
        categoryItems.forEach(i => i.classList.remove("active"));
        el.classList.add("active");
        loadProducts(el.dataset.category);
      });
    });

    loadProducts(); // T·∫£i to√†n b·ªô khi m·ªü trang
  </script>
</body>
</html>
